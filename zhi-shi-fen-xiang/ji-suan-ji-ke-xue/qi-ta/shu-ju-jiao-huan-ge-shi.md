# 数据交换格式

在大数据领域，经常涉及大量的数据传输，其常用数据传输格式有`JSON`，`String`，`Avro`等，那么如何选择消息格式才能达到效果呢？

主要考量的因素不外乎两点

* 1）便捷
* 2）效率

本文对常用数据传输格式进行介绍，并从以上两点对其进行评估，给出各格式的推荐使用场景。

### Json

`Json`是一种以键值对格式记录并传输消息的格式，直观来讲其类似于`Python`中的`dict`或`Java`中的`Map`对象。其格式如下

```
{
    "name" : "spirit",
    "age" : 18
}
```

`Json`是最常用的消息格式，因为其足够灵活，数据结构清晰，并且可读性强，看见一条`Json`即可知道其表达的数据意思，对人友好。此外数据接受端也易于解析，如在`Python`中，只需根据键值还原为`dict`即可，可以说是"开箱即用"。

但其缺点也较为明显，即包含大量冗余信息。以上面`Json`案例为例，对面每一条`Json`格式数据，其都包含`key`：`name`和`age`，而每条数据会变的只有`value`：`spirit`和`18`，因此造成了大量的冗余，增大了传输及后续存储的压力。

### String

`String`格式也成字符串报文，即讲数据直接转化为一定形式的字符串进行传输，数据接收端以相同形式进行解析。 如

```
spirit\t18
```

上述例子中以制表符（）作为分割符，对字符串进行组装并传输，接收端以进行`split`即可。其优势在于不含字段信息，只传输值，一定程度上较少了传输及后续存储的压力。

缺点是相对不够灵活，字段变动会后续解析程序造成较大影响。

### Avro

`Avro`是`Hadoop`中的一个子项目，也是`Apache`中一个独立的项目，是一个基于二进制数据传输高性能的中间件，在传输大量数据时效率高于`Json`及`String`格式。

在使用`Avro`时需先定义一下`Schema`，即数据结构及数据类型等，`Schema`形式如下

```
{
  "namespace" : "cn.microvideo.lab.employee",
  "type": "record",
  "name": "information",
  "fields": [
        {
            "name": "name",
            "type": "string"
        },
        {
            "name": "age",
            "type": "int"
        }
    ]
}
```

而后可根据`Schema`讲要发送的对象转化为`byte array`对象进行发送，接收端以相同`Schema`进行解析即可。

其优势在于效率极高，且通过`Schema`可完美还原数据类型，而缺点在于使用时不够方便，且需要对`Schema`进行维护与管理，以确保`Schema`变动时，接收端顺利解析数据。

### 总结

以上对三种常用消息格式进行了简单介绍，总的来说（长的不看版）

|    格式    |  便捷 |  效率 |       使用场景      |
| :------: | :-: | :-: | :-------------: |
|  `Json`  | ★★★ |  ★  |   数据量小，字段经常变化   |
| `String` |  ★★ |  ★★ | 数据量及字段变化程度均较为均衡 |
|  `Avro`  |  ★  | ★★★ |    数据量大，字段固定    |

其中，便捷及效率满分均为★★★，推荐场景已列出，欢迎采纳或指正。
